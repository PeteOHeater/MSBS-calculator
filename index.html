<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSBS Pension Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input, select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .tax-option {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 5px;
        }

        .tax-option input[type="radio"] {
            width: auto;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 20px auto;
            display: block;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .results {
            margin-top: 40px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .card p {
            color: #555;
            line-height: 1.8;
            margin: 8px 0;
        }

        .highlight {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .breakeven {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
        }

        .breakeven h2 {
            color: #2d3436;
            margin-bottom: 15px;
        }

        .breakeven .age {
            font-size: 3em;
            font-weight: bold;
            color: #d63031;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f5f7fa;
        }

        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MSBS Pension Calculator</h1>

        <div class="input-section">
            <div class="input-group">
                <label for="lumpSum">Employer Benefit Lump Sum ($)</label>
                <input type="number" id="lumpSum" value="500000" step="1000">
            </div>

            <div class="input-group">
                <label for="annualIncome">Annual Income (Ages 55-60) ($)</label>
                <input type="number" id="annualIncome" value="80000" step="1000">
            </div>

            <div class="input-group">
                <label for="cpiRate">Expected CPI/Inflation Rate (%)</label>
                <input type="number" id="cpiRate" value="2.5" step="0.1">
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label>Tax Rate Option</label>
                <div class="tax-option">
                    <input type="radio" id="autoTax" name="taxOption" value="auto" checked>
                    <label for="autoTax" style="margin-bottom: 0;">Use Marginal Tax Rates</label>
                </div>
                <div class="tax-option">
                    <input type="radio" id="manualTax" name="taxOption" value="manual">
                    <label for="manualTax" style="margin-bottom: 0;">Manual Tax Rate (%)</label>
                    <input type="number" id="manualTaxRate" value="45" step="0.1" disabled>
                </div>
            </div>
        </div>

        <button onclick="calculate()">Calculate</button>

        <div id="results" class="results">
            <div class="summary-cards">
                <div class="card">
                    <h3>Take at Age 55</h3>
                    <p>Annual Pension (Year 1): <span id="pension55"></span></p>
                    <p>After Tax (Year 1): <span id="afterTax55"></span></p>
                    <p>Cumulative by Age 60: <span id="cumul55_60"></span></p>
                    <p>Cumulative by Age 100: <span id="cumul55_100"></span></p>
                </div>

                <div class="card">
                    <h3>Take at Age 60</h3>
                    <p>Annual Pension (Year 1): <span id="pension60"></span></p>
                    <p>After Tax (Year 1): <span id="afterTax60"></span></p>
                    <p>Cumulative by Age 65: <span id="cumul60_65"></span></p>
                    <p>Cumulative by Age 100: <span id="cumul60_100"></span></p>
                </div>
            </div>

            <div class="breakeven">
                <h2>Break-Even Analysis</h2>
                <div id="breakevenResult"></div>
            </div>

            <div class="warning">
                <strong>Note:</strong> This calculator includes Australian marginal tax rates (2026), Medicare levy (2%), and Division 293 tax where applicable. MSBS pensions are indexed to CPI. This is for illustrative purposes only and should not replace professional financial advice.
            </div>

            <div class="table-container">
                <table id="detailTable">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Take at 55<br>Annual Pension</th>
                            <th>After Tax</th>
                            <th>Cumulative</th>
                            <th>Take at 60<br>Annual Pension</th>
                            <th>After Tax</th>
                            <th>Cumulative</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Enable/disable manual tax input
        document.querySelectorAll('input[name="taxOption"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('manualTaxRate').disabled = this.value === 'auto';
            });
        });

        function calculateTax(income, useManual, manualRate) {
            if (useManual) {
                return income * (manualRate / 100);
            }

            // 2026 Australian tax rates + 2% Medicare Levy
            let tax = 0;
            const medicareLevy = income * 0.02;

            if (income <= 18200) {
                tax = 0;
            } else if (income <= 45000) {
                tax = (income - 18200) * 0.19;
            } else if (income <= 135000) {
                tax = 5092 + (income - 45000) * 0.325;
            } else if (income <= 190000) {
                tax = 34342 + (income - 135000) * 0.37;
            } else {
                tax = 54692 + (income - 190000) * 0.45;
            }

            return tax + medicareLevy;
        }

        function applyDivision293(totalIncome, pensionAmount) {
            const threshold = 250000;
            if (totalIncome > threshold) {
                const excessAmount = totalIncome - threshold;
                const taxableAmount = Math.min(excessAmount, pensionAmount);
                return taxableAmount * 0.15;
            }
            return 0;
        }

        function calculate() {
            const lumpSum = parseFloat(document.getElementById('lumpSum').value);
            const annualIncome = parseFloat(document.getElementById('annualIncome').value);
            const cpiRate = parseFloat(document.getElementById('cpiRate').value) / 100;
            const useManual = document.getElementById('manualTax').checked;
            const manualRate = parseFloat(document.getElementById('manualTaxRate').value);

            // Pension multiples
            const multiple55 = 12;
            const multiple60 = 11;

            // Calculate base annual pensions
            const basePension55 = lumpSum / multiple55;
            const basePension60 = lumpSum / multiple60;

            // Arrays to store year-by-year data
            let data55 = [];
            let data60 = [];

            let cumulative55 = 0;
            let cumulative60 = 0;

            // Calculate for ages 55 to 100
            for (let age = 55; age <= 100; age++) {
                let yearsFromStart55 = age - 55;
                let yearsFromStart60 = age - 60;

                // Age 55 scenario
                let pension55 = basePension55 * Math.pow(1 + cpiRate, yearsFromStart55);
                let income55 = age < 60 ? annualIncome : 0;
                let totalIncome55 = income55 + pension55;

                let incomeTax55 = calculateTax(totalIncome55, useManual, manualRate);
                let div293Tax55 = applyDivision293(totalIncome55, pension55);
                let afterTax55 = pension55 - incomeTax55 - div293Tax55 + income55 - calculateTax(income55, useManual, manualRate);

                cumulative55 += afterTax55;

                // Age 60 scenario
                let pension60 = 0;
                let afterTax60 = 0;
                let income60 = age < 60 ? annualIncome : 0;

                if (age >= 60) {
                    pension60 = basePension60 * Math.pow(1 + cpiRate, yearsFromStart60);
                    let totalIncome60 = pension60;
                    let incomeTax60 = calculateTax(totalIncome60, useManual, manualRate);
                    let div293Tax60 = applyDivision293(totalIncome60, pension60);
                    afterTax60 = pension60 - incomeTax60 - div293Tax60;
                } else {
                    afterTax60 = income60 - calculateTax(income60, useManual, manualRate);
                }

                cumulative60 += afterTax60;

                data55.push({
                    age: age,
                    pension: pension55,
                    afterTax: afterTax55,
                    cumulative: cumulative55
                });

                data60.push({
                    age: age,
                    pension: pension60,
                    afterTax: afterTax60,
                    cumulative: cumulative60
                });
            }

            // Find break-even age
            let breakevenAge = null;
            for (let i = 0; i < data55.length; i++) {
                if (data60[i].cumulative >= data55[i].cumulative) {
                    breakevenAge = data60[i].age;
                    break;
                }
            }

            // Display summary
            document.getElementById('pension55').textContent = '$' + basePension55.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('afterTax55').textContent = '$' + data55[0].afterTax.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('cumul55_60').textContent = '$' + data55[5].cumulative.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('cumul55_100').textContent = '$' + data55[45].cumulative.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

            document.getElementById('pension60').textContent = '$' + basePension60.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('afterTax60').textContent = '$' + data60[5].afterTax.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('cumul60_65').textContent = '$' + data60[10].cumulative.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('cumul60_100').textContent = '$' + data60[45].cumulative.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

            // Display break-even
            let breakevenHTML = '';
            if (breakevenAge) {
                breakevenHTML = `
                    <p>Break-even age:</p>
                    <div class="age">${breakevenAge}</div>
                    <p>Taking pension at age 55 provides more cumulative income until age ${breakevenAge}.<br>
                    After age ${breakevenAge}, waiting until 60 becomes more beneficial.</p>
                `;
            } else {
                breakevenHTML = `
                    <p class="age">No break-even found</p>
                    <p>Taking pension at age 55 provides more cumulative income throughout your lifetime (to age 100).</p>
                `;
            }
            document.getElementById('breakevenResult').innerHTML = breakevenHTML;

            // Build table
            let tableHTML = '';
            for (let i = 0; i < data55.length; i++) {
                tableHTML += `
                    <tr>
                        <td>${data55[i].age}</td>
                        <td>$${data55[i].pension.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</td>
                        <td>$${data55[i].afterTax.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</td>
                        <td>$${data55[i].cumulative.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</td>
                        <td>${data60[i].pension > 0 ? '$' + data60[i].pension.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',') : '-'}</td>
                        <td>$${data60[i].afterTax.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</td>
                        <td>$${data60[i].cumulative.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}</td>
                    </tr>
                `;
            }
            document.getElementById('tableBody').innerHTML = tableHTML;

            // Show results
            document.getElementById('results').classList.add('show');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Calculate on page load with default values
        window.onload = function() {
            calculate();
        };
    </script>
</body>
</html>